### 4.3.1 Order tables

db_reset/order_tables.js is written in javascript in contrast to other db tools written in bash. This is mainly in order to get acces to data structures not available in bash.

db_reset/order_tables.js is called with 2 arguments. First is the path to tablenames file. Second is the path to foreign key constraints csv file.

the main functionality is taking in a list of tables and returning the tables in the same format sorted by foreign key parent/child relationships. Tables are read and written in simple format of tablenames delimeted by newline characters.

File contains 4 main classes:
- Table
- ForeignKeyTree
- pgTableWriter
- pgTableReader

#### Table
- The primary datastructure for tables with 2 properties.   
- Properties:
  - parent: String (essentially the name of the table)
  - children: Array

#### ForeignKeyTree
- Takes in an array of Tables and sorts them either by breath first search (.sortByGeneration()) or by depth first search (.sortByBranch())
- Properties:
  - tables: Array
  - visited: Array
  - queue: Array
  - root: Table(parent='root')
- initialization:
  - besides setting tables property .addRootChildren is run.

- sortByGeneration():
  - uses a queue to keep track of children of tables. Tables is then visited using af FIFO approach essentially resulting in reading the siblings of the current table before reading the its children.
  - initially the root tables is pushed onto the queue.
  - root is read looking for children adding any to the queue.
  - next in queue is a child of root, which then is read for any children.
    - children will be pushed onto the queue
    - table name will be added to the visited array. Every tablename except the root is pushed onto the visited array. This will result in a sorted list of table names with parents being written before it's children.
    - the process of visiting the children in the queue is repeated until no children is left in the queue.

- addRootChildren():
  - tables who does not have a parent (regardless of it being a parent or not) is written as the child of the root table.
  - Used to initialize the sorting algorithm (both "byGeneration" and "byBranch")


#### pgTableReader
- reads tablenames and foreign key constraints file.
- properties:
  - tablesnamesPath: String
  - foreignKeyConstraintsPath: String
- methods:
  - tablesFor(<treestructure>) 
    - input used is a string equal to the class ordering the tables. For now, only 'ForeignKeyTree' is available.
    - returns an unordered array containing all tablenames 

#### pgTableWriter
- takes in tables prepared for ForeignKeyTree class and writes tablenames using .sortByGeneration
- properties:
  - tree: ForeignKeyTree
- methods:
  - write(<writePath>)
    - calls .sortByGeneration on tree
    - writes sorted tables to <writePath>

